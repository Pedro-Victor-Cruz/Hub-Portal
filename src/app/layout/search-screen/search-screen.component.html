<div class="app-selector">
  <button class="selector-trigger" (click)="toggleSearch()">
    <i class='bx bx-grid-alt'></i>
  </button>

  <div class="selector-search">
    <div class="search">
      <i class='bx bx-search'></i>
      <input type="text"
             placeholder="Pesquisar página..."
             [(ngModel)]="searchQuery"
             (focus)="onSearchFocus()"
             (blur)="onSearchBlur()"
             (input)="handleSearch()">
    </div>

    @if (isSearchText) {
      <div class="search-results">
        @if (searchQuery.trim() === '') {
          <div class="results-column">
            <h4>Pesquisas recentes</h4>
            @if (recentSearches.length > 0) {
              <ul>
                @for (search of recentSearches; track search) {
                  <li (click)="navigate(search.path)">
                    <i class='bx bx-history'></i>
                    <span>{{ search.title }}</span>
                    <i class='bx bx-star' (click)="toggleFavorite(search); $event.stopPropagation()"
                       [class.favorite]="isFavorite(search)"></i>
                  </li>
                }
              </ul>
            } @else {
              <p class="empty-message">Nenhuma pesquisa recente</p>
            }
          </div>

          <div class="results-column">
            <h4>Favoritos</h4>
            @if (favoritePages.length > 0) {
              <ul>
                @for (favorite of favoritePages; track favorite) {
                  <li (click)="navigate(favorite.path)">
                    <i class='bx bx-star'></i>
                    <span>{{ favorite.title }}</span>
                  </li>
                }
              </ul>
            } @else {
              <p class="empty-message">Nenhum favorito adicionado</p>
            }
          </div>
        } @else {
          <div class="search-results-list">
            @if (filteredResults.length > 0) {
              <ul>
                @for (result of filteredResults; track result) {
                  <li (click)="navigate(result.path)">
                    <i [class]="result.icon || 'bx bx-file'"></i>
                    <span>{{ result.title }}</span>
                    <i class='bx bx-star' (click)="toggleFavorite(result); $event.stopPropagation()"
                       [class.favorite]="isFavorite(result)"></i>
                  </li>
                }
              </ul>
            } @else {
              <p class="empty-message">Nenhum resultado encontrado</p>
            }
          </div>
        }
      </div>
    }
  </div>
</div>

<div class="selector-overlay" [class.active]="isSearchModalActive" (click)="isSearchModalActive = false"></div>

<div class="selector-menu" [class.active]="isSearchModalActive">
  <div class="menu-header">
    <h3>Navegação</h3>
    <button class="close-btn" (click)="isSearchModalActive = false">
      <i class='bx bx-x'></i>
    </button>
  </div>

  <div class="search-container">
    <i class='bx bx-search'></i>
    <input type="text"
           [(ngModel)]="searchQuery"
           placeholder="Buscar página..."
           (input)="handleSearch()">
  </div>

  <div class="app-list">
    @if (filteredResults.length > 0) {
      @for (app of filteredResults; track app) {
        <div class="app-item" (click)="navigate(app.path)">
          <div class="app-icon">
            <i [class]="app.icon || 'bx bx-file'"></i>
          </div>
          <div class="app-info">
            <span class="app-title">{{ app.title }}</span>
            @if (app.description) {
              <span class="app-desc">{{ app.description }}</span>
            }
          </div>
          <i class='bx bx-chevron-right'></i>
        </div>
      }
    } @else {
      <div class="empty-state">
        <i class='bx bx-compass'></i>
        <h4>Nenhum resultado encontrado</h4>
        <p>Tente buscar com outros termos ou verifique se a página existe</p>
      </div>
    }
  </div>
</div>
